"use client";
import { getUserLibClient } from "@/database/client-data";
import { generateValue } from "@/lib/generateValue";
import { useQuery } from "@tanstack/react-query";
import { createContext } from "react";
import { listInfo, listSongsSection, SearchProfile } from "@/database/data";
import { Database } from "../../../../database.types";

export type SongListValue = (listInfo | SearchProfile | listSongsSection) & {
  source: Database["public"]["Enums"]["media_source_type"];
};

// Default context value
export const SongListContext = createContext<SongListValue | object>({});
interface ContextSongListContainerProps extends React.ComponentProps<"div"> {
  id: string;
  list: listInfo | SearchProfile | listSongsSection;
}
function ContextSongListContainer({
  id,
  children,
  list,
}: ContextSongListContainerProps) {
  const { data: queryData, error: queryError } = useQuery({
    queryKey: ["user-library"],
    queryFn: () => getUserLibClient(),
  });
  if (queryError) return;
  const { data, error } = queryData || {};
  if (!data || error) return;
  const { userLib } = data;
  const isDataExist = userLib[id];
  const value = generateValue(isDataExist, list);
  return (
    <SongListContext.Provider value={value}>
      {children}
    </SongListContext.Provider>
  );
}

export default ContextSongListContainer;
